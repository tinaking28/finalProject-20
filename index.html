<!DOCTYPE html>
<html>
<head>
	<script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous"></script>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="style.css">
    <link rel="icon" href="logo.png">
	<style type="text/css">
		.answerChosen > p{
			background-image: none;
			background-color: #c2a04b;
			color: #000;
		}

		.answerChosen{
			background-image: none;
			background-color: #c2a04b;
			color: #000;
		}
	</style>
	<title>Who Wants to Be a Millionaire?</title>
	<script>
		round = 1;
		apiCallRound = 0;
		questionsGame = [];
		answersGame = [];
		correctAnswersGame = [];
		currentAnswer = -1;
		winningsStrings = ["Question 1 - Current Winnings: $0",
							"Question 2 - Current Winnings: $500",
							"Question 3 - Current Winnings: $1,000",
							"Question 4 - Current Winnings: $2,000",
							"Question 5 - Current Winnings: $3,000",
							"Question 6 - Current Winnings: $5,000",
							"Question 7 - Current Winnings: $7,000",
							"Question 8 - Current Winnings: $10,000",
							"Question 9 - Current Winnings: $20,000",
							"Question 10 - Current Winnings: $30,000",
							"Question 11 - Current Winnings: $50,000",
							"Question 12 - Current Winnings: $100,000",
							"Question 13 - Current Winnings: $250,000",
							"Question 14 - Current Winnings: $500,000"];
        possible_scores = [0, 500, 1000, 2000, 3000, 5000, 7000, 10000, 20000,
                           30000, 50000, 100000, 250000, 500000, 1000000];      


		function shuffle(array) {
		    var i = array.length,
		        j = 0,
		        temp;

		    while (i--) {

		        j = Math.floor(Math.random() * (i+1));

		        // swap randomly chosen element with current element
		        temp = array[i];
		        array[i] = array[j];
		        array[j] = temp;

		    }

		    return array;
		}

		function checkStatus(response) {
		  if (response.ok) {
		    return Promise.resolve(response);
		  } else {
		    return Promise.reject(new Error(response.statusText));
		  }
		}

		function parseJSON(response) {
		  return response.json();
		}
		
		function apiCalls(){

			// const urls = [
			//   'https://opentdb.com/api.php?amount=5&category=9&difficulty=easy&type=multiple',
			//   'https://opentdb.com/api.php?amount=5&category=9&difficulty=medium&type=multiple'
			// ];

			// // use map() to perform a fetch and handle the response for each url
			// Promise.all(urls.map(url =>
			//   fetch(url)
			//     .then(checkStatus)                 
			//     .then(parseJSON)
			//     .catch(error => console.log('There was a problem!', error))
			// )
			// .then(m => {
			// 		for( var i = 0; i < 5; i ++){
			// 			questionsGame[i + (apiCallRound * 5)] = m.results[i]["question"];
			// 			correctAnswersGame[i + (apiCallRound * 5)] = m.results[i]["correct_answer"];
			// 			answers = [m.results[i]["correct_answer"], m.results[i]["incorrect_answers"][0], m.results[i]["incorrect_answers"][1], m.results[i]["incorrect_answers"][2]];
			// 			var ranNums = shuffle(answers);
			// 			answersGame[i + (apiCallRound * 5)] = ranNums;
			// 		}
			// 		apiCallRound++;
			// 		loadDataNthRound();			
			// 	})

			request = new XMLHttpRequest();
 
			request.open("GET", "https://opentdb.com/api.php?amount=14&category=9&difficulty=easy&type=multiple", true);


			request.onreadystatechange = function() {
	  
				if (request.readyState == 4 && 
					request.status == 200) 
				{
					theData = request.responseText;
					m = JSON.parse(theData);

					for( var i = 0; i < 14; i ++){
						questionsGame[i] = m.results[i]["question"];
                        console.log(questionsGame[i]);
						correctAnswersGame[i] = m.results[i]["correct_answer"];
						answers = [m.results[i]["correct_answer"], m.results[i]["incorrect_answers"][0],
						m.results[i]["incorrect_answers"][1],m.results[i]["incorrect_answers"][2]];
						var ranNums = shuffle(answers);
						answersGame[i] = ranNums;
					}
					loadDataNthRound();
				}
				else if (request.readyState == 4 && request.status != 200) 
				{
				   document.getElementById("timer").innerHTML += "<br>Request failed!";
				}

			}
			request.send();		




			//  		// ***************************************************
			// request = new XMLHttpRequest();
 
			// request.open("GET", "https://opentdb.com/api.php?amount=5&category=9&difficulty=medium&type=multiple", true);


			// request.onreadystatechange = function() {
	  
			// 	if (request.readyState == 4 && 
			// 		request.status == 200) 
			// 	{
			// 		theData = request.responseText;
			// 		m = JSON.parse(theData);
			// 		for(var i = 0; i < 5; i ++){
			// 			questionsGame[i + 5] = m.results[i]["question"];
			// 			answers = [m.results[i]["correct_answer"], m.results[i]["incorrect_answers"][0],
			// 			m.results[i]["incorrect_answers"][1],m.results[i]["incorrect_answers"][2]];
			// 			var ranNums = shuffle(answers);
			// 			answersGame[i + 5] = ranNums;
			// 		}
			// 	}
			// 	else if (request.readyState == 4 && request.status != 200) 
			// 	{
			// 	   document.getElementById("timer").innerHTML += "<br>Request failed!";
			// 	}

			// }
			// request.send();

			// 			request = new XMLHttpRequest();
 
			// request.open("GET", "https://opentdb.com/api.php?amount=4&category=9&difficulty=hard&type=multiple", true);


			// request.onreadystatechange = function() {
	  
			// 	if (request.readyState == 4 && 
			// 		request.status == 200) 
			// 	{
			// 		theData = request.responseText;
			// 		m = JSON.parse(theData);
			// 		for(var i = 0; i < 5; i ++){
			// 			questionsGame[i + 10] = m.results[i]["question"];
			// 			answers = [m.results[i]["correct_answer"], m.results[i]["incorrect_answers"][0],
			// 			m.results[i]["incorrect_answers"][1],m.results[i]["incorrect_answers"][2]];
			// 			var ranNums = shuffle(answers);
			// 			answersGame[i + 10] = ranNums;
			// 		}
			// 	}
			// 	else if (request.readyState == 4 && request.status != 200) 
			// 	{
			// 	   document.getElementById("timer").innerHTML += "<br>Request failed!";
			// 	}

			// }
			// request.send();

		}
		function loadDataNthRound() {
            if (round != 3) { 
				document.getElementById("question").innerHTML = questionsGame[round - 1];
				document.getElementById("answer1").getElementsByTagName('p')[0].innerHTML = answersGame[round - 1][0];
				document.getElementById("answer2").getElementsByTagName('p')[0].innerHTML = answersGame[round - 1][1];
				document.getElementById("answer3").getElementsByTagName('p')[0].innerHTML = answersGame[round - 1][2];
				document.getElementById("answer4").getElementsByTagName('p')[0].innerHTML = answersGame[round - 1][3];
                document.getElementById("winnings").innerHTML = winningsStrings[round - 1];
            }
			round++;
		}

		function checkAnswer(){
			if(answersGame[round - 2][currentAnswer - 1] === correctAnswersGame[round - 2] ){
				//move on
				loadDataNthRound();
				document.getElementById("answer" + currentAnswer).classList.remove('answerChosen');
				currentAnswer = -1;
                // if at question 14 you win
                if (round == 4){
                    document.getElementById("popup-title").innerHTML = "Congrats you win! You are a Millionaire!";
                    endGame();
                }
			}else{
                document.getElementById("popup-title").innerHTML = "Game over. Thanks for playing!";
				endGame();
			}
		}
		function saveAnswer(n){
			if(currentAnswer != -1){
				document.getElementById("answer" + currentAnswer).classList.remove('answerChosen');

			}
			currentAnswer = n + 1;
			document.getElementById("answer" + currentAnswer).classList.add('answerChosen');

		}
		function lifeline(){
            var correctAnswer = correctAnswersGame[round - 2];
            var incorrectIndices = [];
            for(var i = 0; i < 4; i++){
                if(correctAnswer != answersGame[round - 2][i]){
                    incorrectIndices.push(i);
                }
            }

            var first_idx = Math.floor(Math.random() * 3);
            var first = incorrectIndices[first_idx];
            first++;

            incorrectIndices.splice(first_idx, 1);

            var second_idx = Math.floor(Math.random() * 2);
            var second = incorrectIndices[second_idx];
            second++;

            document.getElementById("answer"+first).classList.add('disabled');
            console.log(first);
            console.log(second);
            document.getElementById("answer"+first).getElementsByTagName('p')[0].innerHTML = "";
            document.getElementById("answer"+second).classList.add('disabled');

            document.getElementById("answer"+second).getElementsByTagName('p')[0].innerHTML = "";

            console.log(round);

            console.log(answersGame[round-2][0]);
            console.log(correctAnswersGame[round-2]);
		}

	</script>
</head>
<body>
	<iframe name="frame"></iframe>
	<div id="title">
		<h1>Who Wants to Be a Millionaire?</h1>
	</div>

	<div id="bigBlock">

        <!-- The Modal -->
        <div id="myModal" class="modal">

          <!-- Modal content -->
          <div class="modal-content">
            <div class="modal-header">
              <span class="close">&times;</span>
              <h2 id="popup-title">&nbsp;</h2>
            </div>
            <div class="modal-body">
                <form method="post" id="emailForm" target="frame"
                      action="https://www.eecs.tufts.edu/~sberma04/comp20/email_test/email.php">
                Name: <input type="text" name="theName" id="theName">
                <br /><br />
                Email: <input type="text" name="theEmail">
                <br /><br />
                <!-- You Won: $<div style="display:inline-block" id="score-output">&nbsp;</div> --> 
                You won: $<input type="text" name="theScore" id="theScore">
                <br /> <br />
                <input type="submit" onsubmit="SubmitForm()" value="Record Score">
                <br /><br />
                Click the button above to submit your score to the leaderboard, receive an email
                with your results, and restart the game.
                </form>
                </div>
            <div class="modal-footer">
              <h3>Spend your money wisely...</h3>
            </div>
          </div>

        </div>
		<div id="play" class="border">


		</div>

		<div id="game">
			<div id="center">
				<h2 style="color: #c2a04b" id="winnings">Question 1 - Current Winnings: $0</h2>
				<div id="question"></div>
				<div id="options">
					<div class="answer" id="answer1" onclick="saveAnswer(0)">A: &nbsp; <p></p> </div>
					<div class="answer" id="answer2" onclick="saveAnswer(1)">B: &nbsp; <p></p></div>
					<div class="answer" id="answer3" onclick="saveAnswer(2)">C: &nbsp; <p></p></div>
					<div class="answer" id="answer4" onclick="saveAnswer(3)">D: &nbsp; <p></p></div>
				</div>
					<div class="finalAnswer" id="finalAnswer" onclick="checkAnswer()">Final Answer</div>
					<div class="finalAnswer" id="finalAnswer" onclick="lifeline()">Lifeline</div>
				<div id="timer"></div>
				<script type="text/javascript">
					apiCalls();
				</script>
			</div>
		</div>
		<div id="leaderboard" class="border">
			<audio controls>
            		<source src="theme.mp3" type="audio/mpeg">
            		Your browser does not support the audio element.
           		</audio>
			<h2>Leaderboard</h2>
			<div class="hi-scores">
				<div class="people">
					<p>person1</p>
					<p>person2</p>
				</div>
				<div class="scores">
					<p>score1</p>
					<p>score2</p>
				</div>
			</div>
						<h2>How to Play</h2>
			<h3>Basic Rules</h3>
			<ul>
				<li>You will be asked a series of 14 multiple choice trivia quesitons with increasing difficulty in various topics.</li>
				<li>Each question will have 4 possible answers, with only one correct answer.</li>
				<li>To pick an answer, you need to select the desired choice, then click the "Final Answer" button below the four choices.</li>
				<li>One wrong answer, and its game over, so choose your answers carefully!</li>
			</ul>
			<h3>Lifeline</h3>
			50/50 - you will be able to use this lifeline once, and two of the incorrect answer choices will be eliminated.
			<h3>Payout Structure</h3>
			<ul>
				<li>Question 1 - $500</li>
				<li>Question 2 - $1,000</li>
				<li>Question 3 - $2,000</li>
				<li>Question 4 - $3,000</li>
				<li>Question 5 - $5,000</li>
				<li>Question 6 - $7,000</li>
				<li>Question 7 - $10,000</li>
				<li>Question 8 - $20,000</li>
				<li>Question 9 - $30,000</li>
				<li>Question 10 - $50,000</li>
				<li>Question 11 - $100,000</li>
				<li>Question 12 - $250,000</li>
				<li>Question 13 - $500,000</li>
				<li>Question 14 - $1,000,000</li>
			</ul> 
		</div>
	</div>

    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal 
        function endGame() {
            modal.style.display = "block";
            document.getElementById("theScore").value = possible_scores[round - 2];
            document.getElementById("theScore").readOnly = true;
            //console.log(possible_scores[round - 2]);
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
            location.reload();
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                location.reload();
            }
        }

        function SubmitForm(){
        	var xhttp = new XMLHttpRequest();
        	var name = document.getElementById("theName");
        	var score = document.getElementById("theScore");

        	xhttp.open("POST", "https://frozen-cove-32073.herokuapp.com/", true);
			xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xhttp.send("name=" + name + "&score=" + score);
		}
    </script>
	
    <script language="jquery">

    $(document).ready(function () {

        // Listen to submit event on the <form> itself
        $("#emailForm").submit(function (e) {

        e.preventDefault();

        var name = $("#theName").val();
        var email = $("#theEmail").val();
        var score = $("#theScore").val();

        $.post("email.php", {
            name: name,
            email: email,
            score: score
        }).complete(function() {
            console.log("Success");
        });
        });
    });

    </script>
</body>
</html>